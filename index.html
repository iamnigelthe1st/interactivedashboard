<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
      :root {
        --bg0: #070a12;
        --bg1: #0b1020;
        --card: rgba(255, 255, 255, 0.06);
        --card2: rgba(255, 255, 255, 0.08);
        --stroke: rgba(255, 255, 255, 0.1);
        --muted: rgba(255, 255, 255, 0.72);
        --muted2: rgba(255, 255, 255, 0.55);
        --good: #34d399;
        --warn: #fbbf24;
        --bad: #fb7185;
        --accent: #60a5fa;
        --accent2: #a78bfa;
      }

      body {
        background: radial-gradient(
            1000px 600px at 15% -10%,
            rgba(96, 165, 250, 0.35),
            transparent 55%
          ),
          radial-gradient(
            900px 600px at 110% 10%,
            rgba(167, 139, 250, 0.35),
            transparent 55%
          ),
          radial-gradient(
            900px 700px at 40% 110%,
            rgba(52, 211, 153, 0.22),
            transparent 55%
          ),
          linear-gradient(180deg, var(--bg0), var(--bg1));
        color: rgba(255, 255, 255, 0.92);
        overflow-x: hidden;
        min-height: 100vh;
      }

      .glass {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.08),
          rgba(255, 255, 255, 0.05)
        );
        border: 1px solid var(--stroke);
        box-shadow: 0 12px 35px rgba(0, 0, 0, 0.35),
          inset 0 1px 0 rgba(255, 255, 255, 0.06);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      .gridlines {
        background-image: linear-gradient(
            to right,
            rgba(255, 255, 255, 0.06) 1px,
            transparent 1px
          ),
          linear-gradient(
            to bottom,
            rgba(255, 255, 255, 0.06) 1px,
            transparent 1px
          );
        background-size: 40px 40px;
        mask-image: radial-gradient(
          ellipse at 30% 10%,
          black 30%,
          transparent 70%
        );
        opacity: 0.55;
      }

      .focus-ring:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.35);
      }

      .shimmer {
        position: relative;
        overflow: hidden;
      }
      .shimmer::after {
        content: "";
        position: absolute;
        inset: -40% -40%;
        background: linear-gradient(
          120deg,
          transparent 25%,
          rgba(255, 255, 255, 0.1) 45%,
          transparent 65%
        );
        transform: translateX(-40%) rotate(8deg);
        animation: shimmer 2.6s ease-in-out infinite;
      }
      @keyframes shimmer {
        0% {
          transform: translateX(-60%) rotate(8deg);
          opacity: 0;
        }
        20% {
          opacity: 0.75;
        }
        50% {
          opacity: 0.55;
        }
        100% {
          transform: translateX(60%) rotate(8deg);
          opacity: 0;
        }
      }

      .pop {
        animation: pop 420ms cubic-bezier(0.2, 0.9, 0.2, 1) both;
      }
      @keyframes pop {
        from {
          transform: translateY(10px) scale(0.985);
          opacity: 0;
        }
        to {
          transform: translateY(0) scale(1);
          opacity: 1;
        }
      }

      .pulseDot {
        box-shadow: 0 0 0 0 rgba(96, 165, 250, 0.55);
        animation: pulseDot 1.8s ease-out infinite;
      }
      @keyframes pulseDot {
        0% {
          box-shadow: 0 0 0 0 rgba(96, 165, 250, 0.45);
        }
        70% {
          box-shadow: 0 0 0 12px rgba(96, 165, 250, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(96, 165, 250, 0);
        }
      }

      .tooltip {
        position: fixed;
        pointer-events: none;
        transform: translate(-50%, -120%);
        z-index: 50;
        padding: 8px 10px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(10, 14, 26, 0.82);
        box-shadow: 0 18px 50px rgba(0, 0, 0, 0.38);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        min-width: 140px;
        opacity: 0;
        transition: opacity 120ms ease;
      }
      .tooltip.show {
        opacity: 1;
      }

      canvas {
        display: block;
      }

      @media (prefers-reduced-motion: reduce) {
        .shimmer::after,
        .pulseDot {
          animation: none !important;
        }
        .pop {
          animation: none !important;
        }
      }

      .chip.active {
        background: rgba(96, 165, 250, 0.15);
        border-color: rgba(96, 165, 250, 0.4);
      }

      .rangeBtn.active {
        background: rgba(96, 165, 250, 0.2);
        color: #60a5fa;
      }
    </style>
  </head>
  <body>
    <div class="fixed inset-0 gridlines pointer-events-none"></div>

    <div id="tooltip" class="tooltip">
      <div id="tooltipContent"></div>
    </div>

    <header
      class="sticky top-0 z-40 mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pt-4"
    >
      <div class="glass rounded-2xl px-4 sm:px-6 py-4 pop">
        <div
          class="flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between"
        >
          <div class="flex items-center gap-3">
            <div
              class="size-10 rounded-xl bg-gradient-to-br from-blue-400/80 to-violet-400/80 grid place-items-center border border-white/10 shadow-lg"
            >
              <span class="text-lg font-bold">â–³</span>
            </div>
            <div>
              <h1 class="text-lg sm:text-xl font-semibold tracking-tight">
                Interactive Analytics Dashboard
              </h1>
              <p class="text-sm" style="color: var(--muted2)">
                Animated insights with fake data â€¢
                <span class="inline-flex items-center gap-2"
                  ><span class="size-2 rounded-full bg-blue-400 pulseDot"></span
                  ><span id="lastUpdated">live</span></span
                >
              </p>
            </div>
          </div>

          <div class="flex flex-col sm:flex-row gap-3 sm:items-center">
            <div class="flex gap-2 items-center">
              <label class="text-xs" style="color: var(--muted2)">Range</label>
              <div
                class="flex rounded-xl border border-white/10 overflow-hidden bg-white/5"
              >
                <button
                  data-range="7"
                  class="rangeBtn px-3 py-2 text-sm hover:bg-white/10 transition focus-ring"
                >
                  7d
                </button>
                <button
                  data-range="30"
                  class="rangeBtn px-3 py-2 text-sm hover:bg-white/10 transition focus-ring active"
                >
                  30d
                </button>
                <button
                  data-range="90"
                  class="rangeBtn px-3 py-2 text-sm hover:bg-white/10 transition focus-ring"
                >
                  90d
                </button>
              </div>
            </div>

            <div class="flex gap-2 items-center">
              <label class="text-xs" style="color: var(--muted2)"
                >Segment</label
              >
              <select
                id="segment"
                class="focus-ring rounded-xl bg-white/5 border border-white/10 px-3 py-2 text-sm text-white"
              >
                <option value="all" class="text-slate-900">All Users</option>
                <option value="pro" class="text-slate-900">Pro</option>
                <option value="free" class="text-slate-900">Free</option>
                <option value="enterprise" class="text-slate-900">
                  Enterprise
                </option>
              </select>
            </div>

            <div class="flex gap-2">
              <button
                id="btnRefresh"
                class="focus-ring rounded-xl px-4 py-2 text-sm font-medium border border-white/10 bg-white/5 hover:bg-white/10 transition"
              >
                Regenerate
              </button>
              <button
                id="btnExport"
                class="focus-ring rounded-xl px-4 py-2 text-sm font-medium bg-gradient-to-r from-blue-500/90 to-violet-500/90 hover:from-blue-500 hover:to-violet-500 border border-white/10 shadow-lg transition"
              >
                Export CSV
              </button>
            </div>
          </div>
        </div>

        <div class="mt-4 flex flex-wrap gap-2">
          <button
            class="chip focus-ring text-xs px-3 py-2 rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 transition active"
            data-metric="revenue"
          >
            ðŸ’° Revenue
          </button>
          <button
            class="chip focus-ring text-xs px-3 py-2 rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 transition"
            data-metric="active"
          >
            ðŸ‘¥ Active Users
          </button>
          <button
            class="chip focus-ring text-xs px-3 py-2 rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 transition"
            data-metric="retention"
          >
            ðŸ”„ Retention
          </button>
          <button
            class="chip focus-ring text-xs px-3 py-2 rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 transition"
            data-metric="latency"
          >
            âš¡ Latency
          </button>
        </div>
      </div>
    </header>

    <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6 space-y-6">
      <!-- KPI Grid -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="glass rounded-2xl p-5 pop" style="animation-delay: 50ms">
          <div class="text-sm" style="color: var(--muted2)">Revenue</div>
          <div class="text-3xl font-bold mt-1" id="kpiRevenue">$0</div>
          <div class="mt-1">
            <span
              class="text-xs px-2 py-1 rounded-lg"
              id="deltaRevenue"
              style="background: rgba(52, 211, 153, 0.15); color: #34d399"
              >+0%</span
            >
          </div>
          <canvas
            id="sparkRevenue"
            width="240"
            height="80"
            class="w-full mt-3"
            style="height: 40px"
          ></canvas>
        </div>

        <div class="glass rounded-2xl p-5 pop" style="animation-delay: 100ms">
          <div class="text-sm" style="color: var(--muted2)">Active Users</div>
          <div class="text-3xl font-bold mt-1" id="kpiActive">0</div>
          <div class="mt-1">
            <span
              class="text-xs px-2 py-1 rounded-lg"
              id="deltaActive"
              style="background: rgba(52, 211, 153, 0.15); color: #34d399"
              >+0%</span
            >
          </div>
          <canvas
            id="sparkActive"
            width="240"
            height="80"
            class="w-full mt-3"
            style="height: 40px"
          ></canvas>
        </div>

        <div class="glass rounded-2xl p-5 pop" style="animation-delay: 150ms">
          <div class="text-sm" style="color: var(--muted2)">Retention</div>
          <div class="text-3xl font-bold mt-1" id="kpiRetention">0%</div>
          <div class="mt-1">
            <span
              class="text-xs px-2 py-1 rounded-lg"
              id="deltaRetention"
              style="background: rgba(52, 211, 153, 0.15); color: #34d399"
              >+0%</span
            >
          </div>
          <canvas
            id="sparkRetention"
            width="240"
            height="80"
            class="w-full mt-3"
            style="height: 40px"
          ></canvas>
        </div>

        <div class="glass rounded-2xl p-5 pop" style="animation-delay: 200ms">
          <div class="text-sm" style="color: var(--muted2)">Latency</div>
          <div class="text-3xl font-bold mt-1" id="kpiLatency">0ms</div>
          <div class="mt-1">
            <span
              class="text-xs px-2 py-1 rounded-lg"
              id="deltaLatency"
              style="background: rgba(251, 113, 133, 0.15); color: #fb7185"
              >+0%</span
            >
          </div>
          <canvas
            id="sparkLatency"
            width="240"
            height="80"
            class="w-full mt-3"
            style="height: 40px"
          ></canvas>
        </div>
      </div>

      <!-- Main Content Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main Chart -->
        <div
          class="lg:col-span-2 glass rounded-2xl p-6 pop"
          style="animation-delay: 250ms"
        >
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold" id="chartTitle">Revenue Trend</h2>
            <div class="flex gap-2 text-xs" style="color: var(--muted2)">
              <span>Zoom: Scroll â€¢ Pan: Drag</span>
            </div>
          </div>
          <canvas
            id="mainChart"
            width="1200"
            height="800"
            class="w-full"
            style="height: 400px; cursor: crosshair"
          ></canvas>

          <div class="grid grid-cols-3 gap-4 mt-4">
            <div class="bg-white/5 rounded-xl p-3 border border-white/10">
              <div class="text-xs" style="color: var(--muted2)">
                Anomaly Score
              </div>
              <div class="text-xl font-semibold mt-1" id="anomalyScore">
                0.0
              </div>
              <div
                class="text-xs mt-1"
                id="anomalyLabel"
                style="color: var(--good)"
              >
                Normal
              </div>
            </div>
            <div class="bg-white/5 rounded-xl p-3 border border-white/10">
              <div class="text-xs" style="color: var(--muted2)">
                7-Day Forecast
              </div>
              <div class="text-xl font-semibold mt-1" id="forecast">--</div>
              <div class="text-xs mt-1" style="color: var(--muted2)">
                Linear projection
              </div>
            </div>
            <div class="bg-white/5 rounded-xl p-3 border border-white/10">
              <div class="text-xs mb-2" style="color: var(--muted2)">
                Target Progress
              </div>
              <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                <div
                  id="targetProgress"
                  class="h-full rounded-full transition-all"
                  style="
                    width: 0%;
                    background: linear-gradient(90deg, #60a5fa, #a78bfa);
                  "
                ></div>
              </div>
              <div
                class="text-xs mt-1"
                id="targetText"
                style="color: var(--muted2)"
              >
                0 / 0
              </div>
            </div>
          </div>
        </div>

        <!-- Right Sidebar -->
        <div class="space-y-6">
          <!-- Donut Chart -->
          <div class="glass rounded-2xl p-6 pop" style="animation-delay: 300ms">
            <h3 class="text-sm font-semibold mb-4" style="color: var(--muted)">
              Traffic Sources
            </h3>
            <canvas
              id="donutChart"
              width="400"
              height="400"
              class="w-full mx-auto"
              style="height: 200px; max-width: 200px"
            ></canvas>
            <div class="mt-4 space-y-2">
              <div class="flex items-center justify-between text-sm">
                <span class="flex items-center gap-2"
                  ><span
                    class="size-3 rounded-full"
                    style="background: #60a5fa"
                  ></span
                  >Search</span
                >
                <span id="sourceSearch" style="color: var(--muted2)">0%</span>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span class="flex items-center gap-2"
                  ><span
                    class="size-3 rounded-full"
                    style="background: #34d399"
                  ></span
                  >Direct</span
                >
                <span id="sourceDirect" style="color: var(--muted2)">0%</span>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span class="flex items-center gap-2"
                  ><span
                    class="size-3 rounded-full"
                    style="background: #a78bfa"
                  ></span
                  >Social</span
                >
                <span id="sourceSocial" style="color: var(--muted2)">0%</span>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span class="flex items-center gap-2"
                  ><span
                    class="size-3 rounded-full"
                    style="background: #fbbf24"
                  ></span
                  >Referral</span
                >
                <span id="sourceReferral" style="color: var(--muted2)">0%</span>
              </div>
            </div>
          </div>

          <!-- Event Stream -->
          <div class="glass rounded-2xl p-6 pop" style="animation-delay: 350ms">
            <h3 class="text-sm font-semibold mb-4" style="color: var(--muted)">
              Live Events
            </h3>
            <div
              id="eventStream"
              class="space-y-2 max-h-64 overflow-y-auto"
              style="
                scrollbar-width: thin;
                scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
              "
            ></div>
          </div>
        </div>
      </div>

      <!-- Bottom Section -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Accounts Table -->
        <div
          class="lg:col-span-2 glass rounded-2xl p-6 pop"
          style="animation-delay: 400ms"
        >
          <div
            class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-4"
          >
            <h2 class="text-lg font-semibold">Top Accounts</h2>
            <div class="flex gap-2">
              <input
                type="text"
                id="searchAccounts"
                placeholder="Search companies..."
                class="focus-ring rounded-xl bg-white/5 border border-white/10 px-3 py-2 text-sm text-white placeholder-white/40"
              />
              <select
                id="sortAccounts"
                class="focus-ring rounded-xl bg-white/5 border border-white/10 px-3 py-2 text-sm text-white"
              >
                <option value="name" class="text-slate-900">
                  Sort by Name
                </option>
                <option value="revenue" class="text-slate-900">
                  Sort by Revenue
                </option>
                <option value="users" class="text-slate-900">
                  Sort by Users
                </option>
                <option value="latency" class="text-slate-900">
                  Sort by Latency
                </option>
                <option value="health" class="text-slate-900">
                  Sort by Health
                </option>
              </select>
            </div>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="text-left text-xs" style="color: var(--muted2)">
                  <th class="pb-3 font-medium">Company</th>
                  <th class="pb-3 font-medium">Plan</th>
                  <th class="pb-3 font-medium">Revenue</th>
                  <th class="pb-3 font-medium">Users</th>
                  <th class="pb-3 font-medium">Latency</th>
                  <th class="pb-3 font-medium">Health</th>
                </tr>
              </thead>
              <tbody id="accountsTableBody"></tbody>
            </table>
          </div>
        </div>

        <!-- Simulation Controls -->
        <div class="glass rounded-2xl p-6 pop" style="animation-delay: 450ms">
          <h2 class="text-lg font-semibold mb-4">Simulation</h2>

          <div class="space-y-4">
            <div>
              <label class="text-xs block mb-2" style="color: var(--muted2)"
                >Noise: <span id="noiseValue">0.30</span></label
              >
              <input
                type="range"
                id="noiseSlider"
                min="0"
                max="100"
                value="30"
                class="w-full h-2 rounded-lg appearance-none bg-white/10 focus-ring"
                style="accent-color: #60a5fa"
              />
            </div>

            <div>
              <label class="text-xs block mb-2" style="color: var(--muted2)"
                >Growth: <span id="growthValue">0.15</span></label
              >
              <input
                type="range"
                id="growthSlider"
                min="-50"
                max="50"
                value="15"
                class="w-full h-2 rounded-lg appearance-none bg-white/10 focus-ring"
                style="accent-color: #34d399"
              />
            </div>

            <div>
              <label class="text-xs block mb-2" style="color: var(--muted2)"
                >Incidents: <span id="incidentsValue">2</span></label
              >
              <input
                type="range"
                id="incidentsSlider"
                min="0"
                max="10"
                value="2"
                class="w-full h-2 rounded-lg appearance-none bg-white/10 focus-ring"
                style="accent-color: #fb7185"
              />
            </div>

            <div class="pt-4 border-t border-white/10">
              <label class="text-xs block mb-3" style="color: var(--muted2)"
                >Theme</label
              >
              <div class="grid grid-cols-3 gap-2">
                <button
                  class="themeBtn focus-ring px-3 py-2 text-xs rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition active"
                  data-theme="aurora"
                >
                  Aurora
                </button>
                <button
                  class="themeBtn focus-ring px-3 py-2 text-xs rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition"
                  data-theme="ember"
                >
                  Ember
                </button>
                <button
                  class="themeBtn focus-ring px-3 py-2 text-xs rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition"
                  data-theme="mono"
                >
                  Mono
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer
      class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6 text-center text-sm"
      style="color: var(--muted2)"
    >
      <p>Copyright Â© 2025 Keegan Kinyanjui</p>
    </footer>

    <script>
      // ============================================
      // STATE MANAGEMENT
      // ============================================
      const state = {
        currentMetric: "revenue",
        range: 30,
        segment: "all",
        seed: Date.now(),
        zoomLevel: 1,
        panOffset: 0,
        noise: 0.3,
        growth: 0.15,
        incidents: 2,
        theme: "aurora",
        data: {},
        accounts: [],
        trafficSources: { search: 42, direct: 28, social: 18, referral: 12 },
        events: [],
      };

      // ============================================
      // SEEDED RANDOM NUMBER GENERATOR (Mulberry32)
      // ============================================
      function mulberry32(a) {
        return function () {
          let t = (a += 0x6d2b79f5);
          t = Math.imul(t ^ (t >>> 15), t | 1);
          t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
          return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
        };
      }

      // ============================================
      // UTILITY FUNCTIONS
      // ============================================
      function formatCurrency(num) {
        if (num >= 1000000) return "$" + (num / 1000000).toFixed(1) + "m";
        if (num >= 1000) return "$" + (num / 1000).toFixed(1) + "k";
        return "$" + num.toFixed(0);
      }

      function formatNumber(num) {
        if (num >= 1000000) return (num / 1000000).toFixed(1) + "m";
        if (num >= 1000) return (num / 1000).toFixed(1) + "k";
        return num.toFixed(0);
      }

      function formatPercent(num) {
        return (num * 100).toFixed(1) + "%";
      }

      function formatDelta(current, previous) {
        const delta = ((current - previous) / previous) * 100;
        return (delta >= 0 ? "+" : "") + delta.toFixed(1) + "%";
      }

      function formatDate(date) {
        const months = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "May",
          "Jun",
          "Jul",
          "Aug",
          "Sep",
          "Oct",
          "Nov",
          "Dec",
        ];
        return months[date.getMonth()] + " " + date.getDate();
      }

      function formatRelativeTime(date) {
        const now = new Date();
        const diff = Math.floor((now - date) / 1000);
        if (diff < 60) return diff + "s ago";
        if (diff < 3600) return Math.floor(diff / 60) + "m ago";
        if (diff < 86400) return Math.floor(diff / 3600) + "h ago";
        return Math.floor(diff / 86400) + "d ago";
      }

      // ============================================
      // DATA GENERATION
      // ============================================
      function genSeries(days, baseValue, growth, noise, incidents, seed) {
        const rng = mulberry32(seed);
        const series = [];
        const incidentDays = new Set();

        // Generate random incident days
        for (let i = 0; i < incidents; i++) {
          incidentDays.add(Math.floor(rng() * days));
        }

        for (let i = 0; i < days; i++) {
          // Base trend
          let value = baseValue * (1 + (growth * i) / days);

          // Weekly pattern
          value += baseValue * 0.08 * Math.sin((i * 2 * Math.PI) / 7);

          // Monthly pattern
          value += baseValue * 0.05 * Math.cos((i * 2 * Math.PI) / 30);

          // Random noise
          value += noise * (rng() - 0.5) * baseValue * 0.15;

          // Incident impact
          if (incidentDays.has(i)) {
            const impact = 0.15 + rng() * 0.1; // 15-25% impact
            value *= 1 - impact;
          }

          // Ensure non-negative
          value = Math.max(0, value);
          series.push(value);
        }

        return series;
      }

      function generateAllData() {
        const days = state.range;
        const baseSeed = state.seed;

        state.data = {
          revenue: genSeries(
            days,
            100000,
            state.growth * 1.2,
            state.noise,
            state.incidents,
            baseSeed + 1
          ),
          active: genSeries(
            days,
            5000,
            state.growth * 0.8,
            state.noise * 0.7,
            Math.floor(state.incidents * 0.5),
            baseSeed + 2
          ),
          retention: genSeries(
            days,
            0.9,
            state.growth * 0.02,
            state.noise * 0.05,
            state.incidents,
            baseSeed + 3
          ),
          latency: genSeries(
            days,
            50,
            -state.growth * 0.5,
            state.noise * 0.8,
            state.incidents * 2,
            baseSeed + 4
          ).map((v) => {
            // Incidents cause latency spikes
            return v > 100 ? v * 2 : v;
          }),
        };

        // Generate dates
        state.data.dates = [];
        for (let i = 0; i < days; i++) {
          const date = new Date();
          date.setDate(date.getDate() - (days - i - 1));
          state.data.dates.push(date);
        }
      }

      function generateAccounts() {
        const companies = [
          "TechCorp Inc",
          "DataFlow Systems",
          "CloudNine Ltd",
          "Quantum Labs",
          "Neural Networks Co",
          "ByteForce",
          "Infinity Digital",
          "Apex Solutions",
          "Vertex Analytics",
          "Sigma Technologies",
          "Nexus Innovations",
          "Frontier Systems",
        ];

        const plans = ["Free", "Pro", "Enterprise"];
        const rng = mulberry32(state.seed + 100);

        state.accounts = companies.map((company) => {
          const revenue = 5000 + rng() * 95000;
          const users = Math.floor(100 + rng() * 2900);
          const latency = 20 + rng() * 180;
          const plan = plans[Math.floor(rng() * plans.length)];

          let health = "Healthy";
          if (latency > 200 || revenue < 10000) health = "Risk";
          else if (latency > 100 || revenue < 30000) health = "Watch";

          return { company, plan, revenue, users, latency, health };
        });
      }

      // ============================================
      // CANVAS DRAWING UTILITIES
      // ============================================
      function setupCanvas(canvas) {
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        const ctx = canvas.getContext("2d");
        ctx.scale(dpr, dpr);
        return { ctx, width: rect.width, height: rect.height };
      }

      function drawSparkline(canvasId, data, color, fill = true) {
        const canvas = document.getElementById(canvasId);
        if (!canvas) return;

        const { ctx, width, height } = setupCanvas(canvas);
        ctx.clearRect(0, 0, width, height);

        if (!data || data.length === 0) return;

        const min = Math.min(...data);
        const max = Math.max(...data);
        const range = max - min || 1;

        const padding = 5;
        const chartWidth = width - padding * 2;
        const chartHeight = height - padding * 2;

        ctx.beginPath();
        data.forEach((value, i) => {
          const x = padding + (i / (data.length - 1)) * chartWidth;
          const y =
            padding + chartHeight - ((value - min) / range) * chartHeight;
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        });

        if (fill) {
          ctx.lineTo(width - padding, height - padding);
          ctx.lineTo(padding, height - padding);
          ctx.closePath();

          const gradient = ctx.createLinearGradient(0, 0, 0, height);
          gradient.addColorStop(0, color + "99");
          gradient.addColorStop(0.5, color + "44");
          gradient.addColorStop(1, color + "00");
          ctx.fillStyle = gradient;
          ctx.fill();
        }

        ctx.strokeStyle = color;
        ctx.lineWidth = 2;
        ctx.stroke();
      }

      function drawMainChart() {
        const canvas = document.getElementById("mainChart");
        if (!canvas) return;

        const { ctx, width, height } = setupCanvas(canvas);
        ctx.clearRect(0, 0, width, height);

        const metric = state.currentMetric;
        const data = state.data[metric];
        if (!data || data.length === 0) return;

        const colors = {
          revenue: "#60A5FA",
          active: "#34D399",
          retention: "#A78BFA",
          latency: "#FB7185",
        };
        const color = colors[metric];

        // Calculate visible data window based on zoom and pan
        const startIdx = Math.max(0, state.panOffset);
        const endIdx = Math.min(
          data.length,
          startIdx + Math.floor(data.length / state.zoomLevel)
        );
        const visibleData = data.slice(startIdx, endIdx);

        const min = Math.min(...visibleData);
        const max = Math.max(...visibleData);
        const range = max - min || 1;

        const padding = { top: 20, right: 20, bottom: 40, left: 60 };
        const chartWidth = width - padding.left - padding.right;
        const chartHeight = height - padding.top - padding.bottom;

        // Draw grid
        ctx.strokeStyle = "rgba(255,255,255,0.06)";
        ctx.lineWidth = 1;
        for (let i = 0; i <= 5; i++) {
          const y = padding.top + (i / 5) * chartHeight;
          ctx.beginPath();
          ctx.moveTo(padding.left, y);
          ctx.lineTo(width - padding.right, y);
          ctx.stroke();
        }

        // Draw y-axis labels
        ctx.fillStyle = "rgba(255,255,255,0.55)";
        ctx.font = "11px sans-serif";
        ctx.textAlign = "right";
        for (let i = 0; i <= 5; i++) {
          const value = max - (i / 5) * range;
          const y = padding.top + (i / 5) * chartHeight;
          let label;
          if (metric === "revenue") label = formatCurrency(value);
          else if (metric === "active") label = formatNumber(value);
          else if (metric === "retention") label = formatPercent(value);
          else label = value.toFixed(0) + "ms";
          ctx.fillText(label, padding.left - 10, y + 4);
        }

        // Draw x-axis labels
        ctx.textAlign = "center";
        const labelCount = Math.min(7, visibleData.length);
        for (let i = 0; i < labelCount; i++) {
          const dataIdx = Math.floor(
            (i * (visibleData.length - 1)) / (labelCount - 1)
          );
          const dateIdx = startIdx + dataIdx;
          if (state.data.dates[dateIdx]) {
            const x =
              padding.left + (dataIdx / (visibleData.length - 1)) * chartWidth;
            ctx.fillText(
              formatDate(state.data.dates[dateIdx]),
              x,
              height - padding.bottom + 20
            );
          }
        }

        // Draw data line with smooth curves
        ctx.beginPath();
        visibleData.forEach((value, i) => {
          const x = padding.left + (i / (visibleData.length - 1)) * chartWidth;
          const y =
            padding.top + chartHeight - ((value - min) / range) * chartHeight;
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        });

        // Fill gradient
        ctx.lineTo(padding.left + chartWidth, padding.top + chartHeight);
        ctx.lineTo(padding.left, padding.top + chartHeight);
        ctx.closePath();

        const gradient = ctx.createLinearGradient(
          0,
          padding.top,
          0,
          height - padding.bottom
        );
        gradient.addColorStop(0, color + "99");
        gradient.addColorStop(0.5, color + "44");
        gradient.addColorStop(1, color + "00");
        ctx.fillStyle = gradient;
        ctx.fill();

        // Draw line
        ctx.beginPath();
        visibleData.forEach((value, i) => {
          const x = padding.left + (i / (visibleData.length - 1)) * chartWidth;
          const y =
            padding.top + chartHeight - ((value - min) / range) * chartHeight;
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        });
        ctx.strokeStyle = color;
        ctx.lineWidth = 2.5;
        ctx.stroke();

        // Store chart bounds for interaction
        canvas._chartBounds = {
          padding,
          chartWidth,
          chartHeight,
          min,
          max,
          range,
          startIdx,
          endIdx,
        };
      }

      function drawDonutChart() {
        const canvas = document.getElementById("donutChart");
        if (!canvas) return;

        const { ctx, width, height } = setupCanvas(canvas);
        ctx.clearRect(0, 0, width, height);

        const centerX = width / 2;
        const centerY = height / 2;
        const outerRadius = Math.min(width, height) / 2 - 10;
        const innerRadius = outerRadius * 0.6;

        const sources = state.trafficSources;
        const total =
          sources.search + sources.direct + sources.social + sources.referral;
        const colors = {
          search: "#60A5FA",
          direct: "#34D399",
          social: "#A78BFA",
          referral: "#FBBF24",
        };

        let currentAngle = -Math.PI / 2;

        Object.entries(sources).forEach(([key, value]) => {
          const sliceAngle = (value / total) * 2 * Math.PI;

          ctx.beginPath();
          ctx.arc(
            centerX,
            centerY,
            outerRadius,
            currentAngle,
            currentAngle + sliceAngle
          );
          ctx.arc(
            centerX,
            centerY,
            innerRadius,
            currentAngle + sliceAngle,
            currentAngle,
            true
          );
          ctx.closePath();

          ctx.fillStyle = colors[key];
          ctx.fill();

          currentAngle += sliceAngle;
        });

        // Draw center circle
        ctx.beginPath();
        ctx.arc(centerX, centerY, innerRadius, 0, 2 * Math.PI);
        ctx.fillStyle =
          getComputedStyle(document.documentElement).getPropertyValue(
            "--bg0"
          ) || "#070A12";
        ctx.fill();

        // Update percentages
        document.getElementById("sourceSearch").textContent =
          Math.round((sources.search / total) * 100) + "%";
        document.getElementById("sourceDirect").textContent =
          Math.round((sources.direct / total) * 100) + "%";
        document.getElementById("sourceSocial").textContent =
          Math.round((sources.social / total) * 100) + "%";
        document.getElementById("sourceReferral").textContent =
          Math.round((sources.referral / total) * 100) + "%";
      }

      // ============================================
      // UI UPDATE FUNCTIONS
      // ============================================
      function updateKPIs() {
        const metrics = ["revenue", "active", "retention", "latency"];

        metrics.forEach((metric) => {
          const data = state.data[metric];
          if (!data || data.length === 0) return;

          const current = data[data.length - 1];
          const previous = data[Math.max(0, data.length - 8)] || current;

          let formattedValue;
          if (metric === "revenue") formattedValue = formatCurrency(current);
          else if (metric === "active") formattedValue = formatNumber(current);
          else if (metric === "retention")
            formattedValue = formatPercent(current);
          else formattedValue = current.toFixed(0) + "ms";

          const kpiEl = document.getElementById(
            "kpi" + metric.charAt(0).toUpperCase() + metric.slice(1)
          );
          if (kpiEl) kpiEl.textContent = formattedValue;

          const delta = ((current - previous) / previous) * 100;
          const deltaEl = document.getElementById(
            "delta" + metric.charAt(0).toUpperCase() + metric.slice(1)
          );
          if (deltaEl) {
            deltaEl.textContent =
              (delta >= 0 ? "+" : "") + delta.toFixed(1) + "%";
            deltaEl.style.background =
              delta >= 0 ? "rgba(52,211,153,0.15)" : "rgba(251,113,133,0.15)";
            deltaEl.style.color = delta >= 0 ? "#34D399" : "#FB7185";
          }

          const colors = {
            revenue: "#60A5FA",
            active: "#34D399",
            retention: "#A78BFA",
            latency: "#FB7185",
          };
          drawSparkline(
            "spark" + metric.charAt(0).toUpperCase() + metric.slice(1),
            data,
            colors[metric]
          );
        });
      }

      function updateSideWidgets() {
        const metric = state.currentMetric;
        const data = state.data[metric];
        if (!data || data.length === 0) return;

        // Anomaly Score (standard deviation normalized)
        const recent = data.slice(-14);
        const mean = recent.reduce((a, b) => a + b, 0) / recent.length;
        const variance =
          recent.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / recent.length;
        const stdDev = Math.sqrt(variance);
        const anomalyScore = (stdDev / mean) * 10;

        document.getElementById("anomalyScore").textContent =
          anomalyScore.toFixed(1);
        const anomalyLabel = document.getElementById("anomalyLabel");
        if (anomalyScore < 2) {
          anomalyLabel.textContent = "Normal";
          anomalyLabel.style.color = "#34D399";
        } else if (anomalyScore < 4) {
          anomalyLabel.textContent = "Elevated";
          anomalyLabel.style.color = "#FBBF24";
        } else {
          anomalyLabel.textContent = "High";
          anomalyLabel.style.color = "#FB7185";
        }

        // Forecast (simple linear regression)
        const last7 = data.slice(-7);
        const avgGrowth = (last7[last7.length - 1] - last7[0]) / 7;
        const forecast = data[data.length - 1] + avgGrowth * 7;

        let forecastText;
        if (metric === "revenue") forecastText = formatCurrency(forecast);
        else if (metric === "active") forecastText = formatNumber(forecast);
        else if (metric === "retention") forecastText = formatPercent(forecast);
        else forecastText = forecast.toFixed(0) + "ms";
        document.getElementById("forecast").textContent = forecastText;

        // Target Progress
        const targets = {
          revenue: 150000,
          active: 8000,
          retention: 0.95,
          latency: 40,
        };
        const target = targets[metric];
        const current = data[data.length - 1];
        const progress = Math.min(100, (current / target) * 100);

        document.getElementById("targetProgress").style.width = progress + "%";

        let targetTextValue;
        if (metric === "revenue")
          targetTextValue =
            formatCurrency(current) + " / " + formatCurrency(target);
        else if (metric === "active")
          targetTextValue =
            formatNumber(current) + " / " + formatNumber(target);
        else if (metric === "retention")
          targetTextValue =
            formatPercent(current) + " / " + formatPercent(target);
        else targetTextValue = current.toFixed(0) + "ms / " + target + "ms";
        document.getElementById("targetText").textContent = targetTextValue;
      }

      function updateAccountsTable() {
        const tbody = document.getElementById("accountsTableBody");
        if (!tbody) return;

        const search = document
          .getElementById("searchAccounts")
          .value.toLowerCase();
        const sortBy = document.getElementById("sortAccounts").value;

        let filtered = state.accounts.filter((acc) =>
          acc.company.toLowerCase().includes(search)
        );

        // Sort
        filtered.sort((a, b) => {
          if (sortBy === "name") return a.company.localeCompare(b.company);
          if (sortBy === "revenue") return b.revenue - a.revenue;
          if (sortBy === "users") return b.users - a.users;
          if (sortBy === "latency") return a.latency - b.latency;
          if (sortBy === "health") {
            const order = { Healthy: 0, Watch: 1, Risk: 2 };
            return order[a.health] - order[b.health];
          }
          return 0;
        });

        tbody.innerHTML = filtered
          .map((acc, idx) => {
            const planColors = {
              Free: "#9CA3AF",
              Pro: "#60A5FA",
              Enterprise: "#A78BFA",
            };
            const healthColors = {
              Healthy: "#34D399",
              Watch: "#FBBF24",
              Risk: "#FB7185",
            };

            return `
          <tr class="border-t border-white/10 pop" style="animation-delay: ${
            idx * 50
          }ms">
            <td class="py-3">${acc.company}</td>
            <td class="py-3"><span class="text-xs px-2 py-1 rounded-lg" style="background: ${
              planColors[acc.plan]
            }22; color: ${planColors[acc.plan]}">${acc.plan}</span></td>
            <td class="py-3">${formatCurrency(acc.revenue)}</td>
            <td class="py-3">${formatNumber(acc.users)}</td>
            <td class="py-3">${acc.latency.toFixed(0)}ms</td>
            <td class="py-3"><span class="text-xs px-2 py-1 rounded-lg" style="background: ${
              healthColors[acc.health]
            }22; color: ${healthColors[acc.health]}">${acc.health}</span></td>
          </tr>
        `;
          })
          .join("");
      }

      function addEvent(type, data) {
        const event = {
          type,
          data,
          time: new Date(),
        };

        state.events.unshift(event);
        if (state.events.length > 15) state.events.pop();

        const container = document.getElementById("eventStream");
        if (!container) return;

        const icons = {
          checkout: "ðŸ’³",
          user: "ðŸ‘¤",
          spike: "âš¡",
          error: "âš ï¸",
          deploy: "ðŸš€",
        };

        container.innerHTML = state.events
          .map(
            (e) => `
        <div class="flex items-center justify-between text-sm py-2 border-b border-white/5 pop">
          <span class="flex items-center gap-2">
            <span>${icons[e.type]}</span>
            <span>${e.data}</span>
          </span>
          <span class="text-xs" style="color: var(--muted2)">${formatRelativeTime(
            e.time
          )}</span>
        </div>
      `
          )
          .join("");
      }

      function simulateEvent() {
        const types = ["checkout", "user", "spike", "error", "deploy"];
        const type = types[Math.floor(Math.random() * types.length)];

        let data;
        if (type === "checkout")
          data = "Checkout â€¢ $" + (10 + Math.random() * 490).toFixed(2);
        else if (type === "user")
          data =
            "New User â€¢ " +
            ["Free", "Pro", "Enterprise"][Math.floor(Math.random() * 3)];
        else if (type === "spike")
          data =
            "API Spike â€¢ " +
            ["/api/users", "/api/orders", "/api/analytics"][
              Math.floor(Math.random() * 3)
            ];
        else if (type === "error")
          data =
            "Error â€¢ " +
            ["500", "404", "Timeout"][Math.floor(Math.random() * 3)];
        else data = "Deployment â€¢ v1.2." + Math.floor(Math.random() * 100);

        addEvent(type, data);
      }

      // ============================================
      // CHART INTERACTIONS
      // ============================================
      let isDragging = false;
      let dragStartX = 0;
      let dragStartOffset = 0;

      function setupChartInteractions() {
        const canvas = document.getElementById("mainChart");
        const tooltip = document.getElementById("tooltip");
        const tooltipContent = document.getElementById("tooltipContent");

        canvas.addEventListener("mousemove", (e) => {
          if (isDragging) {
            const deltaX = e.clientX - dragStartX;
            const pixelsPerPoint = canvas._chartBounds
              ? canvas._chartBounds.chartWidth /
                (canvas._chartBounds.endIdx - canvas._chartBounds.startIdx)
              : 1;
            const pointsDelta = Math.floor(-deltaX / pixelsPerPoint);
            state.panOffset = Math.max(
              0,
              Math.min(
                state.data[state.currentMetric].length -
                  Math.floor(
                    state.data[state.currentMetric].length / state.zoomLevel
                  ),
                dragStartOffset + pointsDelta
              )
            );
            drawMainChart();
            return;
          }

          const bounds = canvas._chartBounds;
          if (!bounds) return;

          const rect = canvas.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;

          if (
            x >= bounds.padding.left &&
            x <= rect.width - bounds.padding.right &&
            y >= bounds.padding.top &&
            y <= rect.height - bounds.padding.bottom
          ) {
            const relX = (x - bounds.padding.left) / bounds.chartWidth;
            const visibleData = state.data[state.currentMetric].slice(
              bounds.startIdx,
              bounds.endIdx
            );
            const dataIdx = Math.min(
              visibleData.length - 1,
              Math.floor(relX * visibleData.length)
            );
            const value = visibleData[dataIdx];
            const dateIdx = bounds.startIdx + dataIdx;

            let formattedValue;
            if (state.currentMetric === "revenue")
              formattedValue = formatCurrency(value);
            else if (state.currentMetric === "active")
              formattedValue = formatNumber(value);
            else if (state.currentMetric === "retention")
              formattedValue = formatPercent(value);
            else formattedValue = value.toFixed(0) + "ms";

            tooltipContent.innerHTML = `
            <div class="text-xs" style="color: var(--muted2)">${formatDate(
              state.data.dates[dateIdx]
            )}</div>
            <div class="text-sm font-semibold mt-1">${formattedValue}</div>
          `;
            tooltip.style.left = e.clientX + "px";
            tooltip.style.top = e.clientY + "px";
            tooltip.classList.add("show");
          } else {
            tooltip.classList.remove("show");
          }
        });

        canvas.addEventListener("mouseleave", () => {
          tooltip.classList.remove("show");
        });

        canvas.addEventListener("mousedown", (e) => {
          isDragging = true;
          dragStartX = e.clientX;
          dragStartOffset = state.panOffset;
          canvas.style.cursor = "grabbing";
        });

        canvas.addEventListener("mouseup", () => {
          isDragging = false;
          canvas.style.cursor = "crosshair";
        });

        canvas.addEventListener("wheel", (e) => {
          e.preventDefault();
          const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
          state.zoomLevel = Math.max(
            1,
            Math.min(10, state.zoomLevel * zoomFactor)
          );
          drawMainChart();
        });
      }

      // ============================================
      // EVENT HANDLERS
      // ============================================
      function setupEventHandlers() {
        // Range buttons
        document.querySelectorAll(".rangeBtn").forEach((btn) => {
          btn.addEventListener("click", () => {
            document
              .querySelectorAll(".rangeBtn")
              .forEach((b) => b.classList.remove("active"));
            btn.classList.add("active");
            state.range = parseInt(btn.dataset.range);
            state.panOffset = 0;
            state.zoomLevel = 1;
            generateAllData();
            updateAll();
          });
        });

        // Segment dropdown
        document.getElementById("segment").addEventListener("change", (e) => {
          state.segment = e.target.value;
          updateAll();
        });

        // Regenerate button
        document.getElementById("btnRefresh").addEventListener("click", () => {
          state.seed = Date.now();
          state.panOffset = 0;
          state.zoomLevel = 1;
          generateAllData();
          generateAccounts();
          updateAll();
        });

        // Export CSV button
        document.getElementById("btnExport").addEventListener("click", () => {
          let csv = "Date,Revenue,Active Users,Retention,Latency\n";
          for (let i = 0; i < state.data.dates.length; i++) {
            csv += formatDate(state.data.dates[i]) + ",";
            csv += state.data.revenue[i].toFixed(2) + ",";
            csv += state.data.active[i].toFixed(0) + ",";
            csv += (state.data.retention[i] * 100).toFixed(2) + ",";
            csv += state.data.latency[i].toFixed(2) + "\n";
          }

          const blob = new Blob([csv], { type: "text/csv" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "analytics-export-" + Date.now() + ".csv";
          a.click();
          URL.revokeObjectURL(url);
        });

        // Metric chips
        document.querySelectorAll(".chip").forEach((chip) => {
          chip.addEventListener("click", () => {
            document
              .querySelectorAll(".chip")
              .forEach((c) => c.classList.remove("active"));
            chip.classList.add("active");
            state.currentMetric = chip.dataset.metric;
            state.panOffset = 0;
            state.zoomLevel = 1;

            const titles = {
              revenue: "Revenue Trend",
              active: "Active Users Trend",
              retention: "Retention Trend",
              latency: "Latency Trend",
            };
            document.getElementById("chartTitle").textContent =
              titles[state.currentMetric];

            drawMainChart();
            updateSideWidgets();
          });
        });

        // Noise slider
        const noiseSlider = document.getElementById("noiseSlider");
        const noiseValue = document.getElementById("noiseValue");
        noiseSlider.addEventListener("input", (e) => {
          state.noise = e.target.value / 100;
          noiseValue.textContent = state.noise.toFixed(2);
          generateAllData();
          updateAll();
        });

        // Growth slider
        const growthSlider = document.getElementById("growthSlider");
        const growthValue = document.getElementById("growthValue");
        growthSlider.addEventListener("input", (e) => {
          state.growth = e.target.value / 100;
          growthValue.textContent = state.growth.toFixed(2);
          generateAllData();
          updateAll();
        });

        // Incidents slider
        const incidentsSlider = document.getElementById("incidentsSlider");
        const incidentsValue = document.getElementById("incidentsValue");
        incidentsSlider.addEventListener("input", (e) => {
          state.incidents = parseInt(e.target.value);
          incidentsValue.textContent = state.incidents;
          generateAllData();
          updateAll();
        });

        // Theme buttons
        document.querySelectorAll(".themeBtn").forEach((btn) => {
          btn.addEventListener("click", () => {
            document
              .querySelectorAll(".themeBtn")
              .forEach((b) => b.classList.remove("active"));
            btn.classList.add("active");
            state.theme = btn.dataset.theme;
            applyTheme(state.theme);
          });
        });

        // Search and sort for accounts table
        let searchTimeout;
        document
          .getElementById("searchAccounts")
          .addEventListener("input", () => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(updateAccountsTable, 200);
          });

        document
          .getElementById("sortAccounts")
          .addEventListener("change", updateAccountsTable);

        // Window resize
        let resizeTimeout;
        window.addEventListener("resize", () => {
          clearTimeout(resizeTimeout);
          resizeTimeout = setTimeout(updateAll, 150);
        });
      }

      function applyTheme(theme) {
        const themes = {
          aurora: {
            bg0: "#070A12",
            bg1: "#0B1020",
            accent: "#60A5FA",
            accent2: "#A78BFA",
          },
          ember: {
            bg0: "#1A0A0A",
            bg1: "#2D1010",
            accent: "#FB923C",
            accent2: "#FB7185",
          },
          mono: {
            bg0: "#0F0F0F",
            bg1: "#1A1A1A",
            accent: "#9CA3AF",
            accent2: "#D1D5DB",
          },
        };

        const t = themes[theme];
        const root = document.documentElement;
        root.style.setProperty("--bg0", t.bg0);
        root.style.setProperty("--bg1", t.bg1);
        root.style.setProperty("--accent", t.accent);
        root.style.setProperty("--accent2", t.accent2);

        updateAll();
      }

      function updateAll() {
        updateKPIs();
        drawMainChart();
        updateSideWidgets();
        drawDonutChart();
        updateAccountsTable();
      }

      // ============================================
      // INITIALIZATION
      // ============================================
      function init() {
        generateAllData();
        generateAccounts();
        updateAll();
        setupEventHandlers();
        setupChartInteractions();

        // Start event simulation
        setInterval(simulateEvent, 2000 + Math.random() * 2000);

        // Add initial events
        for (let i = 0; i < 5; i++) {
          simulateEvent();
        }
      }

      // Start the app
      init();
    </script>
  </body>
</html>
